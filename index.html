<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Archimage: Arcane Secrets</title>

    <script>
        // JavaScript rotation —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ telegram-init.js
        console.log('üéÆ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã...');
    </script>

    <!-- –°–¢–ò–õ–ò -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="city/city-mobile.css">
    <link rel="stylesheet" href="wizards/wizard-detail.css">
    <link rel="stylesheet" href="battle/script_battle.css">

    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ portrait —Ä–µ–∂–∏–º–∞ -->
    <script src="portrait-blocker.js"></script>
    

</head>

<body>
    <div class="container">
        <header>
            <h1>üè∞ Archimage: Arcane Secrets</h1>
            <p>–§—Ä–∞–∫—Ü–∏—è: <span id="faction">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
        </header>

        <!-- –§–æ—Ä–º–∞ –≤—ã–±–æ—Ä–∞ —Ñ—Ä–∞–∫—Ü–∏–∏ -->
        <div id="faction-selection" style="display: none; text-align: center; margin-top: 30px;">
            <h2>üßô‚Äç‚ôÇÔ∏è –í—ã–±–æ—Ä —Ñ—Ä–∞–∫—Ü–∏–∏</h2>
            <p style="color: #aaa; margin-bottom: 30px;">–í—ã–±–µ—Ä–∏ —Å–≤–æ—é —Å—Ç–∏—Ö–∏—é –∏ –Ω–∞—á–Ω–∏ —Å—Ç—Ä–æ–∏—Ç—å —Å–≤–æ—é –∞–∫–∞–¥–µ–º–∏—é –º–∞–≥–æ–≤</p>

            <div class="faction-buttons" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; max-width: 400px; margin: 0 auto;">
                <button class="faction-btn fire" onclick="selectFaction('fire')" style="padding: 20px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; background: linear-gradient(145deg, #ff6b6b, #ff5252); color: white;">
                    üî• –û–≥–æ–Ω—å
                </button>
                <button class="faction-btn water" onclick="selectFaction('water')" style="padding: 20px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; background: linear-gradient(145deg, #4d96ff, #3a85f0); color: white;">
                    üíß –í–æ–¥–∞
                </button>
                <button class="faction-btn wind" onclick="selectFaction('wind')" style="padding: 20px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; background: linear-gradient(145deg, #95ffc4, #7ae5b0); color: #333;">
                    üå™ –í–µ—Ç–µ—Ä
                </button>
                <button class="faction-btn earth" onclick="selectFaction('earth')" style="padding: 20px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; background: linear-gradient(145deg, #96ceb4, #82b8a0); color: #333;">
                    üåç –ó–µ–º–ª—è
                </button>
                <button class="faction-btn nature" onclick="selectFaction('nature')" style="padding: 20px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; background: linear-gradient(145deg, #4ade80, #22c55e); color: #333;">
                    üå± –ü—Ä–∏—Ä–æ–¥–∞
                </button>
                <button class="faction-btn poison" onclick="selectFaction('poison')" style="padding: 20px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; background: linear-gradient(145deg, #84cc16, #4ade80); color: #333;">
                    ‚ò£Ô∏è –Ø–¥
                </button>
            </div>
        </div>

        <!-- –ò–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞ -->
        <main id="game-area" style="display: none;">
            <div id="city-view">
                <div class="game-container">
                    <!-- –ü–∞–Ω–µ–ª—å –º–∞–≥–æ–≤ -->
                    <div class="wizards-panel">
                        <h3>üßô‚Äç‚ôÇÔ∏è –ú–∞–≥–∏</h3>
                        <div id="wizards-list">
                            <!-- –ú–∞–≥–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>

                    <!-- –°–µ—Ç–∫–∞ –≥–æ—Ä–æ–¥–∞ -->
                    <div id="city-grid" class="grid grid-3x3">
                        <!-- –Ø—á–µ–π–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ========================================
         –°–¢–†–£–ö–¢–£–†–ê –ó–ê–ì–†–£–ó–ö–ò –°–ö–†–ò–ü–¢–û–í
         ======================================== -->

    <!-- 1. –Ø–î–†–û –°–ò–°–¢–ï–ú–´ (Core) -->
    <script src="core/utilities.js"></script>
    <script src="core/modal-system.js"></script>
    <script src="core/constants.js"></script>
    <script src="core/helpers.js"></script>
    <script src="core/state-manager.js"></script>
    <script src="core/ui_manager.js"></script>
    <script src="core/supabase-client.js"></script>

    <!-- 2. –ë–ê–ó–ê –î–ê–ù–ù–´–• (Database) -->
    <script src="database/db-manager.js"></script>
    <script src="database/game-db-integration.js"></script>
    <script src="database/constructions-init.js"></script>
    <script src="database/onboarding.js"></script>
    <script src="faction-selection-system.js"></script>


    <!-- 3. –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ó–ê–ö–õ–ò–ù–ê–ù–ò–ô (Spells Data) -->
    <script src="spells/data/spell-tiers.js"></script>
    <script src="spells/data/school-config.js"></script>
    <script src="spells/data/spell-basic-data.js"></script>
    <script src="spells/data/spell-full-data.js"></script>
    <script src="spells/data/spell-functions.js"></script>
    <script src="spells/data/spell-types.js"></script>
    <script src="spells/data/index.js"></script>
    <script src="spells/data/spell-registry.js"></script>

    <!-- 4. –ì–û–†–û–î (City) -->
    <script src="city/buildings-config.js"></script>
    <script src="city/city-view-system.js"></script>
    <script src="city/city-clickable-system.js"></script>
    <script src="city/time-currency-system.js"></script>
    <script src="city/time-construction-system.js"></script>
    <script src="city/script_buildings.js"></script>
    <script src="construction-visual-clean.js"></script>
    

    <!-- 5. –ú–ê–ì–ò (Wizards) -->
    <script src="wizards/experience-system.js"></script>
    <script src="wizards/player-level-system.js"></script>
    <script src="wizards/blessing-tower-system.js"></script>
    <script src="wizards/wizard-detail-screen.js"></script>
    <script src="wizards/script_wizards.js"></script>
    <script src="wizards/adventure/adventure-system.js"></script>
    <script src="wizards/adventure/adventure-ui.js"></script>

    <!-- 6. –ë–ò–ë–õ–ò–û–¢–ï–ö–ê –ó–ê–ö–õ–ò–ù–ê–ù–ò–ô (Spells UI) -->
    <script src="spells/library_ui.js"></script>
    <script src="spells/script_spells_standard.js"></script>

    <!-- 7. –ë–û–ï–í–ê–Ø –°–ò–°–¢–ï–ú–ê - –Ø–î–†–û (Battle Core) -->
    <script src="battle/weather.js"></script>
    <script src="battle/damage-system.js"></script>
    <script src="battle/effects-system.js"></script>
    <script src="battle/logger.js"></script>
    <script src="battle/targeting-utils.js"></script>
    <script src="battle/single-target-visual-system.js"></script>
    <script src="battle/multi-layer-protection.js"></script>
    <script src="battle/magic-resistance.js"></script>

    <!-- 8. –ë–û–ï–í–ê–Ø –°–ò–°–¢–ï–ú–ê - –ú–ï–•–ê–ù–ò–ö–ò (Battle Mechanics) -->
    <script src="battle/projectiles.js"></script>
    <script src="battle/summons-manager.js"></script>
    <script src="battle/walls.js"></script>
    <script src="battle/wall-blocking.js"></script>

    <!-- 9. –ë–û–ï–í–ê–Ø –°–ò–°–¢–ï–ú–ê - –ì–õ–ê–í–ù–ê–Ø –õ–û–ì–ò–ö–ê (Battle Main) -->
    <script src="battle/targeting.js"></script>
    <script src="battle/spells.js"></script>
    <script src="battle/core.js"></script>
    <script src="battle/ui.js"></script>
    <script src="battle/battle-timer-manager.js"></script>
    <script src="battle/demo-battle.js"></script>
    <script src="battle/script_battle_setup.js"></script>

    <!-- 10. –õ–û–ì–ò–ö–ê –ó–ê–ö–õ–ò–ù–ê–ù–ò–ô –ü–û –®–ö–û–õ–ê–ú (Spells Logic) -->
    <script src="spells/logic/spells-fire.js"></script>
    <script src="spells/logic/spells-water.js"></script>
    <script src="spells/logic/spells-wind.js"></script>
    <script src="spells/logic/spells-earth.js"></script>
    <script src="spells/logic/spells-nature.js"></script>
    <script src="spells/logic/spells-poison.js"></script>

    <!-- 11. PIXI.JS –†–ï–ù–î–ï–†–ò–ù–ì (Renderer) -->
    <script src="https://cdn.jsdelivr.net/npm/pixi.js@7.x/dist/pixi.min.js"></script>
    <script src="renderer/pixi-core.js"></script>
    <script src="renderer/pixi-wizards.js"></script>
    <script src="renderer/animation-manager.js"></script>
    <script src="renderer/animations-config.js"></script>
    <script src="renderer/impact-detection.js"></script>

    <!-- –£–¢–ò–õ–ò–¢–´ –î–õ–Ø –ê–ù–ò–ú–ê–¶–ò–ô (Animation Utilities) -->
    <script src="animations/animation-utils.js"></script>

    <!-- 12. –ê–ù–ò–ú–ê–¶–ò–ò –ó–ê–ö–õ–ò–ù–ê–ù–ò–ô - –û–ì–û–ù–¨ (Fire Animations) -->
    <script src="animations/fire/spark.js"></script>
    <script src="animations/fire/firebolt.js"></script>
    <script src="animations/fire/fire-wall.js"></script>
    <script src="animations/fire/fireball.js"></script>
    <script src="animations/fire/fire-tsunami.js"></script>
    <script src="animations/fire/burning-effect.js"></script>
    <script src="animations/fire/burning-ground.js"></script>

    <!-- 13. –ê–ù–ò–ú–ê–¶–ò–ò –ó–ê–ö–õ–ò–ù–ê–ù–ò–ô - –í–û–î–ê (Water Animations) -->
    <script src="animations/water/icicle.js"></script>
    <script src="animations/water/frost-arrow.js"></script>
    <script src="animations/water/ice-rain.js"></script>
    <script src="animations/water/blizzard.js"></script>
    <script src="animations/water/absolute_zero.js"></script>

    <!-- 14. –ê–ù–ò–ú–ê–¶–ò–ò –ó–ê–ö–õ–ò–ù–ê–ù–ò–ô - –í–ï–¢–ï–† (Wind Animations) -->
    <script src="animations/wind/gust.js"></script>
    <script src="animations/wind/wind-blade.js"></script>
    <script src="animations/wind/wind-wall.js"></script>
    <script src="animations/wind/storm-cloud.js"></script>
    <script src="animations/wind/chain-lightning.js"></script>

    <!-- 15. –ê–ù–ò–ú–ê–¶–ò–ò –ó–ê–ö–õ–ò–ù–ê–ù–ò–ô - –ó–ï–ú–õ–Ø (Earth Animations) -->
    <script src="animations/earth/pebble.js"></script>
    <script src="animations/earth/stone-spike.js"></script>
    <script src="animations/earth/earth-wall.js"></script>
    <script src="animations/earth/stone-grotto.js"></script>
    <script src="animations/earth/meteor.js"></script>

    <!-- 16. –ê–ù–ò–ú–ê–¶–ò–ò –ó–ê–ö–õ–ò–ù–ê–ù–ò–ô - –ü–†–ò–†–û–î–ê (Nature Animations) -->
    <script src="animations/nature/call-wolf.js"></script>
    <script src="animations/nature/bark-armor.js"></script>
    <script src="animations/nature/leaf-canopy.js"></script>
    <script src="animations/nature/ent-visual.js"></script>
    <script src="animations/nature/meteorokinesis.js"></script>

    <!-- 17. –ê–ù–ò–ú–ê–¶–ò–ò –ó–ê–ö–õ–ò–ù–ê–ù–ò–ô - –Ø–î (Poison Animations) -->
    <script src="animations/poison/poisoned_blade.js"></script>
    <script src="animations/poison/poisoned_glade.js"></script>
    <script src="animations/poison/foul-cloud.js"></script>
    <script src="animations/poison/plague.js"></script>
    <script src="animations/poison/epidemic.js"></script>

    <!-- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø -->
    <script>
        console.log("üìÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...");

        // –ü–æ–ª—É—á–∞–µ–º userId –∏–∑ Telegram WebApp
        let userId = "test_user";
        if (window.Telegram?.WebApp?.initDataUnsafe?.user?.id) {
            userId = window.Telegram.WebApp.initDataUnsafe.user.id.toString();
            console.log("‚úÖ Telegram user ID:", userId);
            console.log("üë§ Telegram username:", window.Telegram.WebApp.initDataUnsafe.user.username);
        } else {
            console.warn("‚ö†Ô∏è Telegram WebApp –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–π ID");
        }

        window.userId = userId;
        window.API_BASE_URL = window.API_BASE_URL || "http://localhost:3000";
        window.userData = window.userData || null;
        window.currentModal = window.currentModal || null;

        console.log(`üÜî UserID: ${window.userId}`);
        console.log(`üåê API Base URL: ${window.API_BASE_URL}`);

        // –ò—Å–ø–æ–ª—å–∑—É–µ–º window.onload –≤–º–µ—Å—Ç–æ DOMContentLoaded
        window.addEventListener('load', function () {
            console.log("üìÑ –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –∑–∞–ø—É—Å–∫ loadUserData...");
            if (typeof window.loadUserData === 'function') {
                window.loadUserData();
            } else {
                console.error("‚ùå –§—É–Ω–∫—Ü–∏—è loadUserData –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.");
                if (typeof window.showFactionSelection === 'function') {
                    console.log("‚ÑπÔ∏è –ü–æ–∫–∞–∑ —Ñ–æ—Ä–º—ã –≤—ã–±–æ—Ä–∞ —Ñ—Ä–∞–∫—Ü–∏–∏ (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç).");
                    window.showFactionSelection();
                }
            }
        });
    </script>

    <script>
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∞–ª—é—Ç—ã –≤—Ä–µ–º–µ–Ω–∏
        window.addEventListener('load', function () {
            setTimeout(() => {
                if (window.userData && typeof window.initTimeCurrency === 'function') {
                    window.initTimeCurrency();
                    console.log('‚è≤Ô∏è –í–∞–ª—é—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
                }
            }, 1000);
        });
    </script>

    <!-- Telegram WebApp –ù–ï –Ω—É–∂–µ–Ω –∑–¥–µ—Å—å ‚Äî —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ telegram-init.js -->
</body>
</html>