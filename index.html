<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Archimage: Arcane Secrets</title>

    <script>
        // JavaScript rotation —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ telegram-init.js
        console.log('üéÆ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã...');
        // –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ü–û–°–õ–ï –∑–∞–≥—Ä—É–∑–∫–∏ Telegram SDK (—Å–º. –Ω–∏–∂–µ)
    </script>

    <!-- –°–¢–ò–õ–ò -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="city/city-mobile.css">
    <link rel="stylesheet" href="wizards/wizard-detail.css">
    <link rel="stylesheet" href="battle/script_battle.css">
    <link rel="stylesheet" href="battle/modal-styles.css">
    <link rel="stylesheet" href="city/building-modals.css">
    <link rel="stylesheet" href="wizards/wizard-detail-bg.css">
    <link rel="stylesheet" href="css/modal-bg-common.css">
    <link rel="stylesheet" href="css/pvp-arena-transparent.css">


    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è -->
    <script>
        // –ö–†–ò–¢–ò–ß–ù–û: –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –°–†–ê–ó–£ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ Telegram SDK
        (function saveReferralParam() {
            try {
                // –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
                console.log('üîç [REFERRAL DEBUG] Telegram WebApp:', !!window.Telegram?.WebApp);
                console.log('üîç [REFERRAL DEBUG] initDataUnsafe:', JSON.stringify(window.Telegram?.WebApp?.initDataUnsafe || {}));

                if (window.Telegram?.WebApp?.initDataUnsafe?.start_param) {
                    const startParam = window.Telegram.WebApp.initDataUnsafe.start_param;
                    if (startParam && startParam.startsWith('ref_')) {
                        localStorage.setItem('archimage_referral_param', startParam);
                        console.log('üîó –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω:', startParam);
                    } else {
                        console.log('üìù start_param –Ω–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π:', startParam);
                    }
                } else {
                    console.log('üìù start_param –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ Telegram.WebApp.initDataUnsafe');
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
                    const urlParams = new URLSearchParams(window.location.search);
                    const urlStartApp = urlParams.get('startapp') || urlParams.get('tgWebAppStartParam');
                    if (urlStartApp) {
                        console.log('üîç [REFERRAL DEBUG] –ù–∞–π–¥–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ URL:', urlStartApp);
                    }
                }
            } catch (e) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞:', e);
            }
        })();

        // –ë–∞–∑–æ–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        if (window.Telegram?.WebApp) {
            const tg = window.Telegram.WebApp;

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç–∞ —Ç–µ–º—ã
            tg.setHeaderColor('#1a1a2e');
            tg.setBackgroundColor('#16213e');

            // –í–∫–ª—é—á–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è
            tg.enableClosingConfirmation();

            // –ì–æ–≤–æ—Ä–∏–º Telegram —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ
            tg.ready();
        }
    </script>

    <!-- TON Connect UI -->
    <script src="https://unpkg.com/@tonconnect/ui@2.0.9/dist/tonconnect-ui.min.js"></script>

    <!-- TON Connect Modal z-index fix -->
    <style>
        /* –£–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ –º–æ–¥–∞–ª–∫–∞ TON Connect –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ */
        [data-tc-wallets-modal-container],
        [data-tc-notification],
        .tc-root,
        #tc-widget-root {
            z-index: 99999 !important;
        }
    </style>

    <!-- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ portrait —Ä–µ–∂–∏–º–∞ (–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–æ –º–æ–¥—É–ª–µ–π) -->
    <script type="module" src="core/portrait-blocker.js"></script>

    <!-- PIXI.js CDN (–¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –¥–æ –º–æ–¥—É–ª–µ–π) -->
    <script src="https://cdn.jsdelivr.net/npm/pixi.js@7.x/dist/pixi.min.js"></script>

    <!-- Eruda: –º–æ–±–∏–ª—å–Ω–∞—è –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (–û–¢–ö–õ–Æ–ß–ï–ù–û –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>eruda.init();</script>
    -->

</head>

<body>
    <div class="container">
        <header>
            <h1>üè∞ Archimage: Arcane Secrets</h1>
            <p>–§—Ä–∞–∫—Ü–∏—è: <span id="faction">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
        </header>

        <!-- –§–æ—Ä–º–∞ –≤—ã–±–æ—Ä–∞ —Ñ—Ä–∞–∫—Ü–∏–∏ -->
        <div id="faction-selection" style="display: none; text-align: center; margin-top: 30px;">
            <h2>üßô‚Äç‚ôÇÔ∏è –í—ã–±–æ—Ä —Ñ—Ä–∞–∫—Ü–∏–∏</h2>
            <p style="color: #aaa; margin-bottom: 30px;">–í—ã–±–µ—Ä–∏ —Å–≤–æ—é —Å—Ç–∏—Ö–∏—é –∏ –Ω–∞—á–Ω–∏ —Å—Ç—Ä–æ–∏—Ç—å —Å–≤–æ—é –∞–∫–∞–¥–µ–º–∏—é –º–∞–≥–æ–≤</p>

            <div class="faction-buttons" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; max-width: 400px; margin: 0 auto;">
                <button class="faction-btn fire" onclick="selectFaction('fire')" style="padding: 20px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; background: linear-gradient(145deg, #ff6b6b, #ff5252); color: white;">
                    üî• –û–≥–æ–Ω—å
                </button>
                <button class="faction-btn water" onclick="selectFaction('water')" style="padding: 20px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; background: linear-gradient(145deg, #4d96ff, #3a85f0); color: white;">
                    üíß –í–æ–¥–∞
                </button>
                <button class="faction-btn wind" onclick="selectFaction('wind')" style="padding: 20px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; background: linear-gradient(145deg, #95ffc4, #7ae5b0); color: #333;">
                    üå™ –í–µ—Ç–µ—Ä
                </button>
                <button class="faction-btn earth" onclick="selectFaction('earth')" style="padding: 20px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; background: linear-gradient(145deg, #96ceb4, #82b8a0); color: #333;">
                    üåç –ó–µ–º–ª—è
                </button>
                <button class="faction-btn nature" onclick="selectFaction('nature')" style="padding: 20px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; background: linear-gradient(145deg, #4ade80, #22c55e); color: #333;">
                    üå± –ü—Ä–∏—Ä–æ–¥–∞
                </button>
                <button class="faction-btn poison" onclick="selectFaction('poison')" style="padding: 20px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; background: linear-gradient(145deg, #84cc16, #4ade80); color: #333;">
                    ‚ò£Ô∏è –Ø–¥
                </button>
            </div>
        </div>

        <!-- –ò–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞ -->
        <main id="game-area" style="display: none;">
            <div id="city-view">
                <div class="game-container">
                    <!-- –ü–∞–Ω–µ–ª—å –º–∞–≥–æ–≤ -->
                    <div class="wizards-panel">
                        <h3>üßô‚Äç‚ôÇÔ∏è –ú–∞–≥–∏</h3>
                        <div id="wizards-list">
                            <!-- –ú–∞–≥–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>

                    <!-- –°–µ—Ç–∫–∞ –≥–æ—Ä–æ–¥–∞ -->
                    <div id="city-grid" class="grid grid-3x3">
                        <!-- –Ø—á–µ–π–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ========================================
         Asset Preloader (–∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –∞—Å—Å–µ—Ç–æ–≤)
         ======================================== -->
    <script type="module" src="/core/asset-preloader.js"></script>

    <!-- ========================================
         VITE: –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
         ======================================== -->
    <script type="module" src="/main.js"></script>

    <!-- Telegram WebApp –ù–ï –Ω—É–∂–µ–Ω –∑–¥–µ—Å—å ‚Äî —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ telegram-init.js -->
</body>
</html>
