// i18n.js - –°–∏—Å—Ç–µ–º–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
// –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–æ–≤

/**
 * –°–ª–æ–≤–∞—Ä—å –ø–µ—Ä–µ–≤–æ–¥–æ–≤
 * –ö–ª—é—á–∏ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –ø–æ –º–æ–¥—É–ª—é: airdrop_, shop_, guild_, battle_ –∏ —Ç.–¥.
 * –ù–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Å—é–¥–∞ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ
 */
const STRINGS = {
    // === AIRDROP MODAL ===
    airdrop_title: {
        ru: 'ü™Ç AIRDROP',
        en: 'ü™Ç AIRDROP'
    },
    airdrop_your_bpm: {
        ru: '–¢–≤–æ–∏ BPM coin ü™ô',
        en: 'Your BPM coin ü™ô'
    },
    airdrop_tap_details: {
        ru: 'üìä –ù–∞–∂–º–∏ –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏',
        en: 'üìä Tap for details'
    },
    airdrop_wallet_ton: {
        ru: 'üëõ –ö–æ—à–µ–ª–µ–∫ TON',
        en: 'üëõ TON Wallet'
    },
    airdrop_not_connected: {
        ru: '–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω',
        en: 'Not connected'
    },
    airdrop_disconnect: {
        ru: '–û—Ç–∫–ª—é—á–∏—Ç—å',
        en: 'Disconnect'
    },
    airdrop_connect: {
        ru: '–ü–æ–¥–∫–ª—é—á–∏—Ç—å',
        en: 'Connect'
    },
    airdrop_tasks: {
        ru: 'üéØ –ó–∞–¥–∞–Ω–∏—è',
        en: 'üéØ Tasks'
    },
    airdrop_join_group: {
        ru: 'üë• –í—Å—Ç—É–ø–∏—Ç—å –≤ –≥—Ä—É–ø–ø—É',
        en: 'üë• Join group'
    },
    airdrop_join_reward: {
        ru: '+500 BPM + ‚è∞ 2 –¥–Ω—è',
        en: '+500 BPM + ‚è∞ 2 days'
    },
    airdrop_join_btn: {
        ru: '–í—Å—Ç—É–ø–∏—Ç—å',
        en: 'Join'
    },
    airdrop_check_btn: {
        ru: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        en: 'Check'
    },
    airdrop_checking: {
        ru: '–ü—Ä–æ–≤–µ—Ä–∫–∞...',
        en: 'Checking...'
    },
    airdrop_claimed: {
        ru: '‚úì –ü–æ–ª—É—á–µ–Ω–æ',
        en: '‚úì Claimed'
    },
    airdrop_play: {
        ru: '–ò–≥—Ä–∞—Ç—å',
        en: 'Play'
    },
    airdrop_start: {
        ru: '–ù–∞—á–∞—Ç—å',
        en: 'Start'
    },
    airdrop_task_reward_100: {
        ru: '+100 BPM + ‚è∞ 2 —á–∞—Å–∞',
        en: '+100 BPM + ‚è∞ 2 hours'
    },
    airdrop_referral_title: {
        ru: 'üë• –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞',
        en: 'üë• Referral Program'
    },
    airdrop_your_link: {
        ru: 'üîó –¢–≤–æ—è —Å—Å—ã–ª–∫–∞:',
        en: 'üîó Your link:'
    },
    airdrop_copy: {
        ru: 'üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å',
        en: 'üìã Copy'
    },
    airdrop_share: {
        ru: 'üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è',
        en: 'üì§ Share'
    },
    airdrop_referral_reward: {
        ru: '–ó–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞: +200 BPM + ‚è∞ 12 —á–∞—Å–æ–≤',
        en: 'Per friend: +200 BPM + ‚è∞ 12 hours'
    },
    airdrop_invited_count: {
        ru: '–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ –¥—Ä—É–∑–µ–π',
        en: 'Friends invited'
    },
    airdrop_earned_from_refs: {
        ru: '–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ —Å —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤',
        en: 'Earned from referrals'
    },
    airdrop_close: {
        ru: '‚úï –ó–∞–∫—Ä—ã—Ç—å',
        en: '‚úï Close'
    },

    // === NOTIFICATIONS (airdrop) ===
    notif_reward_already_claimed: {
        ru: '‚úì –ù–∞–≥—Ä–∞–¥–∞ —É–∂–µ –ø–æ–ª—É—á–µ–Ω–∞',
        en: '‚úì Reward already claimed'
    },
    notif_user_error: {
        ru: '‚ùå –û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',
        en: '‚ùå Error: could not identify user'
    },
    notif_gift_kombat_done: {
        ru: 'üéâ Gift Kombat –∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!',
        en: 'üéâ Gift Kombat task completed!'
    },
    notif_char_not_found: {
        ru: '‚ùå –ü–µ—Ä—Å–æ–Ω–∞–∂ 2 —É—Ä–æ–≤–Ω—è –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–¥–æ–ª–∂–∞–π –∏–≥—Ä–∞—Ç—å!',
        en: '‚ùå Level 2 character not found. Keep playing!'
    },
    notif_check_failed: {
        ru: '‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ',
        en: '‚ö†Ô∏è Could not verify. Try again later'
    },
    notif_reward_received: {
        ru: 'üéâ –ù–∞–≥—Ä–∞–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞!',
        en: 'üéâ Reward received!'
    },
    notif_link_copied: {
        ru: 'üìã –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!',
        en: 'üìã Link copied!'
    },
    notif_wallet_connected: {
        ru: 'üëõ –ö–æ—à–µ–ª—ë–∫ –ø–æ–¥–∫–ª—é—á—ë–Ω!',
        en: 'üëõ Wallet connected!'
    },
    notif_wallet_disconnected: {
        ru: 'üëõ –ö–æ—à–µ–ª—ë–∫ –æ—Ç–∫–ª—é—á—ë–Ω',
        en: 'üëõ Wallet disconnected'
    },
    notif_wallet_error: {
        ru: '‚ùå –ö–æ—à–µ–ª—ë–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.',
        en: '‚ùå Wallet unavailable. Try refreshing the page.'
    },

    notif_join_group_first: {
        ru: 'üë• –í—Å—Ç—É–ø–∏—Ç–µ –≤ –≥—Ä—É–ø–ø—É –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å" —Å–Ω–æ–≤–∞',
        en: 'üë• Join the group and press "Check" again'
    },
    notif_reward_received_bpm_days: {
        ru: 'üéâ –ù–∞–≥—Ä–∞–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞!',
        en: 'üéâ Reward received!'
    },
    notif_already_claimed_before: {
        ru: '‚úì –ù–∞–≥—Ä–∞–¥–∞ —É–∂–µ –ø–æ–ª—É—á–µ–Ω–∞ —Ä–∞–Ω–µ–µ',
        en: '‚úì Reward already claimed before'
    },
    notif_not_subscribed: {
        ru: '‚ùå –í—ã –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –≥—Ä—É–ø–ø—É. –í—Å—Ç—É–ø–∏—Ç–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.',
        en: '‚ùå You are not subscribed to the group. Join and try again.'
    },
    notif_check_error: {
        ru: '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.',
        en: '‚ùå Verification error. Try again later.'
    },
    notif_network_error: {
        ru: '‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.',
        en: '‚ùå Network error. Try again later.'
    },
    notif_connect_error: {
        ru: '‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è',
        en: '‚ùå Connection error'
    },
    notif_disconnect_error: {
        ru: '‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞',
        en: '‚ùå Wallet disconnect error'
    },
    notif_gift_kombat_hint: {
        ru: 'ü•ä –ü–æ–ª—É—á–∏ 2 —É—Ä–æ–≤–µ–Ω—å –≤ Gift Kombat –∏ –Ω–∞–∂–º–∏ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å"',
        en: 'ü•ä Reach level 2 in Gift Kombat and press "Check"'
    },

    // === BREAKDOWN MODAL ===
    breakdown_title: {
        ru: 'üìä –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è BPM',
        en: 'üìä BPM Breakdown'
    },
    breakdown_total: {
        ru: '–í—Å–µ–≥–æ',
        en: 'Total'
    },
    breakdown_close: {
        ru: '–ó–∞–∫—Ä—ã—Ç—å',
        en: 'Close'
    },

    // === AIRDROP TASKS (specific) ===
    airdrop_creaky_tasks: {
        ru: 'üìã Creaky Tasks | –í—ã–ø–æ–ª–Ω–∏—Ç—å 3 –ª—é–±—ã—Ö –∑–∞–¥–∞–Ω–∏—è',
        en: 'üìã Creaky Tasks | Complete 3 any tasks'
    },
    airdrop_creaky_btn: {
        ru: '–í—ã–ø–æ–ª–Ω–∏—Ç—å',
        en: 'Complete'
    },
    airdrop_money_mining: {
        ru: '‚õèÔ∏è –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ –∏–≥—Ä–µ Money Mining',
        en: '‚õèÔ∏è Join Money Mining game'
    },
    airdrop_pandafit: {
        ru: 'üêº PandaFiT: –ø—Ä–æ–∫–∞—á–∞–π –ø–∞–Ω–¥—É –¥–æ 5 lvl –∏ –∑–∞–±–∏—Ä–∞–π –Ω–∞–≥—Ä–∞–¥—É',
        en: 'üêº PandaFiT: level up panda to 5 lvl and claim reward'
    },
    airdrop_gift_kombat: {
        ru: 'ü•ä Gift Kombat | –ü–æ–ª—É—á–∏ 2—É—Ä. –∏ –Ω–∞—á–Ω–∏ —Å—Ä–∞–∂–µ–Ω–∏–µ –∑–∞ NFT –ø–æ–¥–∞—Ä–∫–∏',
        en: 'ü•ä Gift Kombat | Reach lvl 2 and fight for NFT gifts'
    },

    // === AIRDROP HOW TO EARN ===
    airdrop_how_to_earn: {
        ru: 'üìà –ö–∞–∫ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å BPM coin',
        en: 'üìà How to earn BPM coin'
    },
    airdrop_earn_pvp: {
        ru: '‚öîÔ∏è –ü–æ–±–µ–¥–∞ –≤ PvP',
        en: '‚öîÔ∏è PvP Victory'
    },
    airdrop_earn_daily: {
        ru: 'üìÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –≤—Ö–æ–¥',
        en: 'üìÖ Daily login'
    },
    airdrop_earn_spell: {
        ru: 'üìö –ò–∑—É—á–µ–Ω–∏–µ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è',
        en: 'üìö Learning a spell'
    },
    airdrop_earn_invite: {
        ru: 'üë• –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥—Ä—É–≥–∞',
        en: 'üë• Inviting a friend'
    },
    airdrop_earn_building: {
        ru: 'üè∞ –ü–æ—Å—Ç—Ä–æ–π–∫–∞/—É–ª—É—á—à–µ–Ω–∏–µ –∑–¥–∞–Ω–∏—è',
        en: 'üè∞ Build/upgrade a building'
    },
    airdrop_earn_pve: {
        ru: 'üéØ –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –≥–ª–∞–≤—ã PvE',
        en: 'üéØ Completing PvE chapter'
    },
    airdrop_earn_streak: {
        ru: 'üî• Streak 7/30/100 –¥–Ω–µ–π',
        en: 'üî• Streak 7/30/100 days'
    },
    airdrop_earn_stars: {
        ru: '‚≠ê 100 Telegram Stars',
        en: '‚≠ê 100 Telegram Stars'
    },
    airdrop_top_players: {
        ru: 'üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤',
        en: 'üèÜ Top Players'
    },
    airdrop_loading: {
        ru: '–ó–∞–≥—Ä—É–∑–∫–∞...',
        en: 'Loading...'
    },
    airdrop_back: {
        ru: '‚Üê –ù–∞–∑–∞–¥',
        en: '‚Üê Back'
    },
    airdrop_invite: {
        ru: 'üéÅ –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å',
        en: 'üéÅ Invite'
    },
    airdrop_news: {
        ru: 'üì¢ –ù–æ–≤–æ—Å—Ç–∏',
        en: 'üì¢ News'
    },

    // === COMMON ===
    common_close: {
        ru: '–ó–∞–∫—Ä—ã—Ç—å',
        en: 'Close'
    },
    common_back: {
        ru: '–ù–∞–∑–∞–¥',
        en: 'Back'
    },
    common_save: {
        ru: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å',
        en: 'Save'
    },
    common_cancel: {
        ru: '–û—Ç–º–µ–Ω–∞',
        en: 'Cancel'
    },
    common_yes: {
        ru: '–î–∞',
        en: 'Yes'
    },
    common_no: {
        ru: '–ù–µ—Ç',
        en: 'No'
    },
    common_hours: {
        ru: '—á–∞—Å–æ–≤',
        en: 'hours'
    },
    common_days: {
        ru: '–¥–Ω–µ–π',
        en: 'days'
    },
};

/**
 * –¢–µ–∫—É—â–∏–π —è–∑—ã–∫ ('ru' –∏–ª–∏ 'en')
 */
let currentLang = 'ru';

/**
 * –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
 * –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: localStorage > Telegram language_code > 'ru'
 */
function detectLanguage() {
    // 1. –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    try {
        const saved = localStorage.getItem('game_lang');
        if (saved === 'ru' || saved === 'en') {
            return saved;
        }
    } catch (e) {}

    // 2. –Ø–∑—ã–∫ –∏–∑ Telegram
    try {
        const tgLang = window.Telegram?.WebApp?.initDataUnsafe?.user?.language_code;
        if (tgLang && !tgLang.startsWith('ru')) {
            return 'en';
        }
    } catch (e) {}

    // 3. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî —Ä—É—Å—Å–∫–∏–π
    return 'ru';
}

/**
 * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
 */
function initI18n() {
    currentLang = detectLanguage();
    window.LANG = currentLang;
    console.log(`üåê –Ø–∑—ã–∫ / Language: ${currentLang}`);
}

/**
 * –ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥ –ø–æ –∫–ª—é—á—É
 * @param {string} key - –∫–ª—é—á –∏–∑ STRINGS
 * @param {string} [fallback] - –∑–∞–ø–∞—Å–Ω–æ–π —Ç–µ–∫—Å—Ç –µ—Å–ª–∏ –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω
 * @returns {string}
 */
function t(key, fallback) {
    const entry = STRINGS[key];
    if (!entry) {
        // –ö–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º fallback –∏–ª–∏ —Å–∞–º –∫–ª—é—á
        return fallback || key;
    }
    return entry[currentLang] || entry['ru'] || fallback || key;
}

/**
 * –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —è–∑—ã–∫
 * @param {string} [lang] - 'ru' –∏–ª–∏ 'en'. –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –Ω–∞ –¥—Ä—É–≥–æ–π
 */
function switchLanguage(lang) {
    if (lang) {
        currentLang = lang;
    } else {
        currentLang = currentLang === 'ru' ? 'en' : 'ru';
    }

    window.LANG = currentLang;

    try {
        localStorage.setItem('game_lang', currentLang);
    } catch (e) {}

    console.log(`üåê –Ø–∑—ã–∫ –ø–µ—Ä–µ–∫–ª—é—á—ë–Ω –Ω–∞: ${currentLang}`);

    // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –æ—Ç–∫—Ä—ã—Ç—ã–π Airdrop –º–æ–¥–∞–ª –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
    const airdropOverlay = document.getElementById('airdrop-overlay');
    if (airdropOverlay) {
        if (typeof setupAirdropUI === 'function') {
            setupAirdropUI();
        }
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —è–∑—ã–∫–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
    updateLangButton();
}

/**
 * –û–±–Ω–æ–≤–∏—Ç—å –∏–∫–æ–Ω–∫—É –Ω–∞ –∫–Ω–æ–ø–∫–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —è–∑—ã–∫–∞
 */
function updateLangButton() {
    const btn = document.getElementById('lang-switch-btn');
    if (btn) {
        btn.textContent = currentLang === 'ru' ? 'üá¨üáß' : 'üá∑üá∫';
        btn.title = currentLang === 'ru' ? 'Switch to English' : '–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–∏–π';
    }
}

/**
 * –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π —è–∑—ã–∫
 * @returns {string}
 */
function getLang() {
    return currentLang;
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
initI18n();

// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤ window
window.t = t;
window.switchLanguage = switchLanguage;
window.getLang = getLang;
window.updateLangButton = updateLangButton;
window.STRINGS = STRINGS;
