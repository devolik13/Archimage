# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–±—Ä–æ—Å—É —Å–µ–∑–æ–Ω–∞ PVP

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ —Å–µ–∑–æ–Ω–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å PVP –ª–µ—Å—Ç–Ω–∏—Ü—É, –¥–∞–≤–∞—è –∏–≥—Ä–æ–∫–∞–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—ã –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –ª–∏–≥ —Å–Ω–æ–≤–∞.

## –ù–∞–≥—Ä–∞–¥—ã –∑–∞ –ª–∏–≥–∏

–ö–∞–∂–¥–∞—è –ª–∏–≥–∞ –¥–∞–µ—Ç –Ω–∞–≥—Ä–∞–¥—ã **–æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ —Å–µ–∑–æ–Ω**:

| –õ–∏–≥–∞ | –†–µ–π—Ç–∏–Ω–≥ | –í—Ä–µ–º—è | Airdrop –æ—á–∫–∏ |
|------|---------|-------|--------------|
| üî∞ –ê–¥–µ–ø—Ç –≤–æ–ª—à–µ–±—Å—Ç–≤–∞ | 0-999 | 50 | 100 |
| üìò –£—á–µ–Ω–∏–∫ –º–∞–≥–∞ | 1000-1499 | 150 | 250 |
| üìó –ú–∞–≥-–ø–æ–¥–º–∞—Å—Ç–µ—Ä—å–µ | 1500-1999 | 300 | 500 |
| üîÆ –ò—Å–∫—É—Å–Ω—ã–π –º–∞–≥ | 2000-2499 | 500 | 1000 |
| ‚ú® –ú–∞—Å—Ç–µ—Ä –º–∞–≥–∏–∏ | 2500-2999 | 1000 | 2000 |
| ‚≠ê –í–µ–ª–∏–∫–∏–π –º–∞–≥ | 3000-3999 | 2000 | 4000 |
| üî• –í–µ—Ä—Ö–æ–≤–Ω—ã–π –º–∞–≥ | 4000-9998 | 5000 | 10000 |
| üëë –ê—Ä—Ö–∏–º–∞–≥ | 9999+ | 10000 | 25000 |

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–±—Ä–æ—Å —Å–µ–∑–æ–Ω–∞

–ü—Ä–∏ —Å–±—Ä–æ—Å–µ —Å–µ–∑–æ–Ω–∞:

1. **–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–æ–º–µ—Ä —Å–µ–∑–æ–Ω–∞** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å 1 –Ω–∞ 2)
2. **–°–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è —Ä–µ–π—Ç–∏–Ω–≥ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤** (soft reset):
   - –§–æ—Ä–º—É–ª–∞: `–Ω–æ–≤—ã–π_—Ä–µ–π—Ç–∏–Ω–≥ = max(500, (—Å—Ç–∞—Ä—ã–π_—Ä–µ–π—Ç–∏–Ω–≥ / 2) + 500)`
   - –ü—Ä–∏–º–µ—Ä—ã:
     - 3000 ‚Üí 2000
     - 2000 ‚Üí 1500
     - 1000 ‚Üí 1000
     - 500 ‚Üí 500
3. **–û—á–∏—â–∞—é—Ç—Å—è –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã** (–º–∞—Å—Å–∏–≤ `season_league_rewards_claimed`)
4. **–û–±–Ω–æ–≤–ª—è—é—Ç—Å—è –¥–∞—Ç—ã —Å–µ–∑–æ–Ω–∞** (season_start_date, season_end_date)

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É –Ω–æ–≤–æ–≥–æ —Å–µ–∑–æ–Ω–∞

### –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí SQL Editor

### –®–∞–≥ 2: –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 016 (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞)

```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–∞–±–ª–∏—Ü–∞ season_config
SELECT * FROM season_config;

-- –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü—ã –Ω–µ—Ç, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é 016
-- (—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ 016_add_season_system.sql)
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å–µ–∑–æ–Ω

```sql
-- –£–∑–Ω–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Å–µ–∑–æ–Ω
SELECT * FROM get_current_season();
```

### –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ–≤—ã–π —Å–µ–∑–æ–Ω

```sql
-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å (—Å–µ–∑–æ–Ω —É–≤–µ–ª–∏—á–∏—Ç—Å—è –Ω–∞ 1)
SELECT start_new_season();

-- –ò–õ–ò —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ —Å–µ–∑–æ–Ω–∞
SELECT start_new_season(2);
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
SELECT * FROM season_config;

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–æ–≤
SELECT
    username,
    rating AS new_rating,
    current_season,
    season_league_rewards_claimed
FROM players
ORDER BY rating DESC
LIMIT 10;
```

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï**: –°–±—Ä–æ—Å —Å–µ–∑–æ–Ω–∞ –Ω–µ–æ–±—Ä–∞—Ç–∏–º! –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ:
1. –í—ã —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç–µ–∫—É—â–µ–≥–æ —Å–µ–∑–æ–Ω–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
2. –ò–≥—Ä–æ–∫–∏ –±—ã–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω—ã –æ —Å–±—Ä–æ—Å–µ –∑–∞—Ä–∞–Ω–µ–µ
3. –í—ã–±—Ä–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è (–æ–±—ã—á–Ω–æ –≤ –º–µ–∂—Å–µ–∑–æ–Ω—å–µ)

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ–∑–æ–Ω–∞

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–µ–∑–æ–Ω–∞

```sql
-- –¢–æ–ø-10 –∏–≥—Ä–æ–∫–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ —Å–µ–∑–æ–Ω–∞
SELECT
    username,
    rating,
    wins,
    losses,
    current_season
FROM players
WHERE current_season = (SELECT current_season FROM season_config LIMIT 1)
ORDER BY rating DESC
LIMIT 10;
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–¥–∞–Ω–Ω—ã—Ö –Ω–∞–≥—Ä–∞–¥

```sql
-- –ò–≥—Ä–æ–∫–∏, –ø–æ–ª—É—á–∏–≤—à–∏–µ –≤—Å–µ –Ω–∞–≥—Ä–∞–¥—ã –≤ —Å–µ–∑–æ–Ω–µ
SELECT
    username,
    rating,
    array_length(season_league_rewards_claimed, 1) as rewards_count,
    season_league_rewards_claimed
FROM players
WHERE array_length(season_league_rewards_claimed, 1) > 0
ORDER BY rewards_count DESC;
```

## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±—Ä–æ—Å–∞ —Å–µ–∑–æ–Ω–∞ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Supabase Edge Functions –∏–ª–∏ pg_cron:

```sql
-- –ü—Ä–∏–º–µ—Ä —Å pg_cron (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
SELECT cron.schedule(
    'monthly-season-reset',
    '0 0 1 * *', -- –ü–µ—Ä–≤–æ–µ —á–∏—Å–ª–æ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞ –≤ 00:00
    $$ SELECT start_new_season(); $$
);
```

## –û—Ç–∫–∞—Ç —Å–µ–∑–æ–Ω–∞ (–≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏)

–ï—Å–ª–∏ —Å–±—Ä–æ—Å –ø—Ä–æ–∏–∑–æ—à–µ–ª –ø–æ –æ—à–∏–±–∫–µ, –º–æ–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –æ—Ç–∫–∞—Ç–∏—Ç—å:

```sql
-- –¢–û–õ–¨–ö–û –í –≠–ö–°–¢–†–ï–ù–ù–´–• –°–õ–£–ß–ê–Ø–•!
-- 1. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π –Ω–æ–º–µ—Ä —Å–µ–∑–æ–Ω–∞
UPDATE season_config SET current_season = current_season - 1 WHERE id = 1;

-- 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥–∏ –∏–∑ –±—ç–∫–∞–ø–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
-- ...

-- 3. –û—á–∏—Å—Ç–∏—Ç—å —Ñ–ª–∞–≥–∏ –Ω–∞–≥—Ä–∞–¥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
UPDATE players SET season_league_rewards_claimed = '{}';
```

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Supabase
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è 016 –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ—É–Ω–∫—Ü–∏–∏ start_new_season()
