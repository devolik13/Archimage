<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç –≤–∏–¥–µ–æ-–∞–Ω–∏–º–∞—Ü–∏–∏</title>
    <style>
        body {
            margin: 0;
            background: #1a1a2e;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
            color: white;
        }
        .controls {
            margin: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        button {
            padding: 10px 20px;
            background: #7289da;
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover { background: #5a6ebd; }
        .canvas-container {
            position: relative;
            border: 2px solid #333;
            background: #0a0a15;
        }
        .info {
            margin: 10px;
            color: #aaa;
            font-size: 12px;
        }
        input[type="range"] {
            width: 150px;
        }
        input[type="file"] {
            padding: 10px;
            background: #333;
            border-radius: 6px;
        }
        label { margin-right: 10px; }
        .blend-modes {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 10px;
        }
        .blend-modes button.active {
            background: #4CAF50;
        }
    </style>
</head>
<body>
    <h2>üé¨ –¢–µ—Å—Ç –≤–∏–¥–µ–æ-–∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è</h2>

    <div class="controls">
        <input type="file" id="videoFile" accept="video/*">
    </div>

    <div class="controls">
        <label>–ú–∞—Å—à—Ç–∞–±: <span id="scaleValue">1.0</span></label>
        <input type="range" id="scaleSlider" min="0.1" max="3" step="0.1" value="1">

        <label>–°–∫–æ—Ä–æ—Å—Ç—å: <span id="speedValue">1.0</span>x</label>
        <input type="range" id="speedSlider" min="0.25" max="3" step="0.25" value="1">
    </div>

    <div class="blend-modes">
        <span>Blend Mode:</span>
        <button data-blend="NORMAL" class="active">Normal</button>
        <button data-blend="ADD">Add (–¥–ª—è —á—ë—Ä–Ω–æ–≥–æ —Ñ–æ–Ω–∞)</button>
        <button data-blend="SCREEN">Screen</button>
        <button data-blend="MULTIPLY">Multiply</button>
    </div>

    <div class="controls">
        <button id="playBtn">‚ñ∂ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏</button>
        <button id="loopBtn">üîÅ –ó–∞—Ü–∏–∫–ª–∏—Ç—å</button>
        <button id="resetBtn">‚Ü∫ –°–±—Ä–æ—Å–∏—Ç—å</button>
    </div>

    <div class="canvas-container">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
    </div>

    <div class="info">
        <div id="videoInfo">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–µ–æ –¥–ª—è —Ç–µ—Å—Ç–∞</div>
        <div id="sizeInfo"></div>
    </div>

    <script src="https://pixijs.download/v7.3.2/pixi.min.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PixiJS
        const app = new PIXI.Application({
            view: document.getElementById('gameCanvas'),
            width: 800,
            height: 600,
            backgroundColor: 0x0a0a15,
            antialias: true
        });

        let videoSprite = null;
        let videoTexture = null;
        let isLooping = false;
        let currentBlendMode = PIXI.BLEND_MODES.NORMAL;

        // –†–∏—Å—É–µ–º —Å–µ—Ç–∫—É –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–∑–∏—Ü–∏–∏
        const graphics = new PIXI.Graphics();
        graphics.lineStyle(1, 0x333333, 0.5);
        for (let x = 0; x <= 800; x += 100) {
            graphics.moveTo(x, 0);
            graphics.lineTo(x, 600);
        }
        for (let y = 0; y <= 600; y += 100) {
            graphics.moveTo(0, y);
            graphics.lineTo(800, y);
        }
        // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫—Ä–µ—Å—Ç
        graphics.lineStyle(2, 0x7289da, 0.8);
        graphics.moveTo(400, 0);
        graphics.lineTo(400, 600);
        graphics.moveTo(0, 300);
        graphics.lineTo(800, 300);
        app.stage.addChild(graphics);

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ
        document.getElementById('videoFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const url = URL.createObjectURL(file);
            loadVideo(url, file);
        });

        function loadVideo(url, file) {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ –≤–∏–¥–µ–æ
            if (videoSprite) {
                app.stage.removeChild(videoSprite);
                videoSprite.destroy();
            }

            // –°–æ–∑–¥–∞—ë–º video element
            const video = document.createElement('video');
            video.src = url;
            video.crossOrigin = 'anonymous';
            video.loop = isLooping;
            video.muted = true;
            video.playsInline = true;

            video.addEventListener('loadedmetadata', () => {
                // –°–æ–∑–¥–∞—ë–º —Ç–µ–∫—Å—Ç—É—Ä—É –∏–∑ –≤–∏–¥–µ–æ
                videoTexture = PIXI.Texture.from(video);
                videoSprite = new PIXI.Sprite(videoTexture);

                // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º
                videoSprite.anchor.set(0.5);
                videoSprite.x = 400;
                videoSprite.y = 300;

                // –ü—Ä–∏–º–µ–Ω—è–µ–º blend mode
                videoSprite.blendMode = currentBlendMode;

                app.stage.addChild(videoSprite);

                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ
                const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
                document.getElementById('videoInfo').textContent =
                    `üìπ ${file.name} | ${video.videoWidth}x${video.videoHeight} | ${video.duration.toFixed(2)}—Å`;
                document.getElementById('sizeInfo').textContent =
                    `üì¶ –†–∞–∑–º–µ—Ä: ${sizeMB} MB`;

                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç—É—Ä—É –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä
                app.ticker.add(() => {
                    if (videoTexture) {
                        videoTexture.update();
                    }
                });
            });
        }

        // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        document.getElementById('playBtn').addEventListener('click', () => {
            if (videoSprite && videoSprite.texture.baseTexture.resource.source) {
                const video = videoSprite.texture.baseTexture.resource.source;
                video.currentTime = 0;
                video.play();
            }
        });

        document.getElementById('loopBtn').addEventListener('click', (e) => {
            isLooping = !isLooping;
            e.target.style.background = isLooping ? '#4CAF50' : '#7289da';
            if (videoSprite && videoSprite.texture.baseTexture.resource.source) {
                videoSprite.texture.baseTexture.resource.source.loop = isLooping;
            }
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            if (videoSprite && videoSprite.texture.baseTexture.resource.source) {
                const video = videoSprite.texture.baseTexture.resource.source;
                video.pause();
                video.currentTime = 0;
            }
        });

        // –ú–∞—Å—à—Ç–∞–±
        document.getElementById('scaleSlider').addEventListener('input', (e) => {
            const scale = parseFloat(e.target.value);
            document.getElementById('scaleValue').textContent = scale.toFixed(1);
            if (videoSprite) {
                videoSprite.scale.set(scale);
            }
        });

        // –°–∫–æ—Ä–æ—Å—Ç—å
        document.getElementById('speedSlider').addEventListener('input', (e) => {
            const speed = parseFloat(e.target.value);
            document.getElementById('speedValue').textContent = speed.toFixed(2);
            if (videoSprite && videoSprite.texture.baseTexture.resource.source) {
                videoSprite.texture.baseTexture.resource.source.playbackRate = speed;
            }
        });

        // Blend modes
        document.querySelectorAll('.blend-modes button').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.blend-modes button').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');

                const mode = e.target.dataset.blend;
                currentBlendMode = PIXI.BLEND_MODES[mode];

                if (videoSprite) {
                    videoSprite.blendMode = currentBlendMode;
                }
            });
        });
    </script>
</body>
</html>
