<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprite Preview - Archimage</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        label {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
        }

        select, input {
            padding: 10px 15px;
            border: 1px solid #444;
            border-radius: 5px;
            background: #2a2a4a;
            color: #fff;
            font-size: 14px;
            min-width: 150px;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #ffd700;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background: #ffd700;
            color: #1a1a2e;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover {
            background: #ffed4a;
            transform: scale(1.05);
        }

        button.active {
            background: #4ade80;
        }

        .preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
        }

        .preview-box {
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid #333;
        }

        .preview-box h3 {
            margin-bottom: 15px;
            color: #4ade80;
        }

        .sprite-canvas {
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
            image-rendering: pixelated;
        }

        .full-sheet {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            border: 1px solid #444;
        }

        .info {
            margin-top: 15px;
            font-size: 12px;
            color: #888;
        }

        .animation-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 25px;
            background: rgba(255,255,255,0.1);
            border: 1px solid #444;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab:hover {
            background: rgba(255,255,255,0.2);
        }

        .tab.active {
            background: #ffd700;
            color: #1a1a2e;
            border-color: #ffd700;
        }

        .hidden {
            display: none !important;
        }

        #customPath {
            width: 400px;
        }
    </style>
</head>
<body>
    <h1>üßô Sprite Preview - Archimage</h1>

    <div class="tabs">
        <div class="tab active" data-tab="wizards">–ú–∞–≥–∏</div>
        <div class="tab" data-tab="spells">–ó–∞–∫–ª–∏–Ω–∞–Ω–∏—è</div>
        <div class="tab" data-tab="custom">–°–≤–æ–π –ø—É—Ç—å</div>
    </div>

    <!-- Wizards Tab -->
    <div id="wizards-tab" class="tab-content">
        <div class="controls">
            <div class="control-group">
                <label>–§—Ä–∞–∫—Ü–∏—è</label>
                <select id="faction">
                    <option value="fire">üî• –û–≥–æ–Ω—å</option>
                    <option value="water">üíß –í–æ–¥–∞</option>
                    <option value="wind">üå™Ô∏è –í–µ—Ç–µ—Ä</option>
                    <option value="earth">ü™® –ó–µ–º–ª—è</option>
                    <option value="nature">üåø –ü—Ä–∏—Ä–æ–¥–∞</option>
                    <option value="poison">‚ò†Ô∏è –Ø–¥</option>
                    <option value="light">‚ú® –°–≤–µ—Ç</option>
                    <option value="dark">üåë –¢—å–º–∞</option>
                </select>
            </div>

            <div class="control-group">
                <label>–ê–Ω–∏–º–∞—Ü–∏—è</label>
                <select id="animation">
                    <option value="idle">Idle (–ø–æ–∫–æ–π)</option>
                    <option value="cast">Cast (–∫–∞—Å—Ç)</option>
                    <option value="death">Death (—Å–º–µ—Ä—Ç—å)</option>
                </select>
            </div>

            <div class="control-group">
                <label>–†–∞–∑–º–µ—Ä –∫–∞–¥—Ä–∞</label>
                <select id="frameSize">
                    <option value="256">256√ó256</option>
                    <option value="128">128√ó128</option>
                    <option value="512">512√ó512</option>
                </select>
            </div>

            <div class="control-group">
                <label>–°–µ—Ç–∫–∞</label>
                <select id="gridSize">
                    <option value="5">5√ó5 (25 –∫–∞–¥—Ä–æ–≤)</option>
                    <option value="4">4√ó4 (16 –∫–∞–¥—Ä–æ–≤)</option>
                    <option value="8">8√ó1 (8 –∫–∞–¥—Ä–æ–≤)</option>
                </select>
            </div>

            <div class="control-group">
                <label>&nbsp;</label>
                <button id="loadWizard">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Spells Tab -->
    <div id="spells-tab" class="tab-content hidden">
        <div class="controls">
            <div class="control-group">
                <label>–®–∫–æ–ª–∞</label>
                <select id="spellSchool">
                    <option value="fire">üî• –û–≥–æ–Ω—å</option>
                    <option value="water">üíß –í–æ–¥–∞</option>
                    <option value="wind">üå™Ô∏è –í–µ—Ç–µ—Ä</option>
                    <option value="earth">ü™® –ó–µ–º–ª—è</option>
                    <option value="nature">üåø –ü—Ä–∏—Ä–æ–¥–∞</option>
                    <option value="poison">‚ò†Ô∏è –Ø–¥</option>
                    <option value="light">‚ú® –°–≤–µ—Ç</option>
                    <option value="dark">üåë –¢—å–º–∞</option>
                </select>
            </div>

            <div class="control-group">
                <label>–ó–∞–∫–ª–∏–Ω–∞–Ω–∏–µ</label>
                <select id="spellName">
                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </select>
            </div>

            <div class="control-group">
                <label>&nbsp;</label>
                <button id="loadSpell">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Custom Tab -->
    <div id="custom-tab" class="tab-content hidden">
        <div class="controls">
            <div class="control-group">
                <label>–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ—Ä–Ω—è)</label>
                <input type="text" id="customPath" placeholder="images/wizards/light/idle.webp">
            </div>

            <div class="control-group">
                <label>–†–∞–∑–º–µ—Ä –∫–∞–¥—Ä–∞</label>
                <select id="customFrameSize">
                    <option value="256">256√ó256</option>
                    <option value="128">128√ó128</option>
                    <option value="512">512√ó512</option>
                </select>
            </div>

            <div class="control-group">
                <label>–°–µ—Ç–∫–∞</label>
                <select id="customGridSize">
                    <option value="5">5√ó5 (25 –∫–∞–¥—Ä–æ–≤)</option>
                    <option value="4">4√ó4 (16 –∫–∞–¥—Ä–æ–≤)</option>
                    <option value="8">8√ó1 (8 –∫–∞–¥—Ä–æ–≤)</option>
                </select>
            </div>

            <div class="control-group">
                <label>&nbsp;</label>
                <button id="loadCustom">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Preview Area -->
    <div class="preview-container">
        <div class="preview-box">
            <h3>–ê–Ω–∏–º–∞—Ü–∏—è</h3>
            <canvas id="animCanvas" class="sprite-canvas" width="256" height="256"></canvas>
            <div class="animation-controls">
                <button id="playBtn" class="active">‚ñ∂ Play</button>
                <button id="stopBtn">‚èπ Stop</button>
                <button id="prevFrame">‚óÄ Prev</button>
                <button id="nextFrame">Next ‚ñ∂</button>
            </div>
            <div class="speed-control">
                <label>–°–∫–æ—Ä–æ—Å—Ç—å:</label>
                <input type="range" id="speed" min="1" max="30" value="12">
                <span id="speedValue">12 FPS</span>
            </div>
            <div class="info" id="frameInfo">–ö–∞–¥—Ä: 0 / 0</div>
        </div>

        <div class="preview-box">
            <h3>–ü–æ–ª–Ω—ã–π —Å–ø—Ä–∞–π—Ç-–ª–∏—Å—Ç</h3>
            <img id="fullSheet" class="full-sheet" src="" alt="Sprite Sheet">
            <div class="info" id="sheetInfo">–†–∞–∑–º–µ—Ä: -</div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π –ø–æ —à–∫–æ–ª–∞–º
        const SPELLS_CONFIG = {
            fire: ['spark', 'firebolt', 'fireball', 'fire_wall', 'fire_tsunami'],
            water: ['icicle', 'frost_arrow', 'ice_rain', 'blizzard', 'absolute_zero'],
            wind: ['gust', 'wind_blade', 'wind_wall', 'storm_cloud', 'ball_lightning'],
            earth: ['pebble', 'stone_spike', 'earth_wall', 'stone_grotto', 'meteor'],
            nature: ['call_wolf', 'bark_armor', 'leaf_canopy', 'ent'],
            poison: ['poisoned_blade', 'poisoned_glade', 'foul_cloud', 'plague', 'epidemic'],
            light: ['flash', 'light_beam', 'rainbow_shield', 'sun_radiance', 'dawn'],
            dark: ['dark_clot', 'weakness', 'miasma', 'shadow_realm', 'fading']
        };

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ
        let currentImage = null;
        let currentFrame = 0;
        let totalFrames = 25;
        let frameWidth = 256;
        let frameHeight = 256;
        let gridColumns = 5;
        let isPlaying = true;
        let animationId = null;
        let lastFrameTime = 0;
        let fps = 12;

        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const animCanvas = document.getElementById('animCanvas');
        const ctx = animCanvas.getContext('2d');
        const fullSheet = document.getElementById('fullSheet');
        const frameInfo = document.getElementById('frameInfo');
        const sheetInfo = document.getElementById('sheetInfo');
        const speedSlider = document.getElementById('speed');
        const speedValue = document.getElementById('speedValue');

        // –¢–∞–±—ã
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
                tab.classList.add('active');
                document.getElementById(`${tab.dataset.tab}-tab`).classList.remove('hidden');
            });
        });

        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π
        function updateSpellList() {
            const school = document.getElementById('spellSchool').value;
            const spellSelect = document.getElementById('spellName');
            spellSelect.innerHTML = '';

            SPELLS_CONFIG[school].forEach(spell => {
                const option = document.createElement('option');
                option.value = spell;
                option.textContent = spell;
                spellSelect.appendChild(option);
            });
        }

        document.getElementById('spellSchool').addEventListener('change', updateSpellList);
        updateSpellList();

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø—Ä–∞–π—Ç–∞ –º–∞–≥–∞
        document.getElementById('loadWizard').addEventListener('click', () => {
            const faction = document.getElementById('faction').value;
            const animation = document.getElementById('animation').value;
            const size = parseInt(document.getElementById('frameSize').value);
            const grid = document.getElementById('gridSize').value;

            frameWidth = size;
            frameHeight = size;

            if (grid === '8') {
                gridColumns = 8;
                totalFrames = 8;
            } else {
                gridColumns = parseInt(grid);
                totalFrames = gridColumns * gridColumns;
            }

            const path = `../images/wizards/${faction}/${animation}.webp`;
            loadSprite(path);
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è
        document.getElementById('loadSpell').addEventListener('click', () => {
            const school = document.getElementById('spellSchool').value;
            const spell = document.getElementById('spellName').value;

            // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –ø—É—Ç–∏
            const paths = [
                `../images/spells/${school}/${spell}/${spell}_sprite.webp`,
                `../images/spells/${school}/${spell}/${spell}_spritesheet.webp`,
                `../images/spells/${school}/${spell}/sprite.webp`,
                `../images/spells/${school}/${spell}.webp`
            ];

            tryLoadPaths(paths);
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ —Å–≤–æ–µ–º—É –ø—É—Ç–∏
        document.getElementById('loadCustom').addEventListener('click', () => {
            const path = '../' + document.getElementById('customPath').value;
            const size = parseInt(document.getElementById('customFrameSize').value);
            const grid = document.getElementById('customGridSize').value;

            frameWidth = size;
            frameHeight = size;

            if (grid === '8') {
                gridColumns = 8;
                totalFrames = 8;
            } else {
                gridColumns = parseInt(grid);
                totalFrames = gridColumns * gridColumns;
            }

            loadSprite(path);
        });

        // –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ —Å–ø–∏—Å–∫–∞ –ø—É—Ç–µ–π
        function tryLoadPaths(paths, index = 0) {
            if (index >= paths.length) {
                alert('–°–ø—Ä–∞–π—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –ø—É—Ç—è–º');
                return;
            }

            const img = new Image();
            img.onload = () => {
                currentImage = img;
                fullSheet.src = paths[index];

                // –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–µ—Ç–∫–∏
                const cols = Math.round(img.width / 256);
                const rows = Math.round(img.height / 256);

                if (cols === rows) {
                    gridColumns = cols;
                    totalFrames = cols * cols;
                    frameWidth = 256;
                    frameHeight = 256;
                } else if (rows === 1) {
                    gridColumns = cols;
                    totalFrames = cols;
                    frameWidth = img.width / cols;
                    frameHeight = img.height;
                }

                animCanvas.width = frameWidth;
                animCanvas.height = frameHeight;

                currentFrame = 0;
                sheetInfo.textContent = `–†–∞–∑–º–µ—Ä: ${img.width}√ó${img.height} | –°–µ—Ç–∫–∞: ${gridColumns}√ó${Math.ceil(totalFrames/gridColumns)} | –ö–∞–¥—Ä–æ–≤: ${totalFrames}`;

                if (isPlaying) startAnimation();
            };
            img.onerror = () => tryLoadPaths(paths, index + 1);
            img.src = paths[index];
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø—Ä–∞–π—Ç–∞
        function loadSprite(path) {
            const img = new Image();
            img.onload = () => {
                currentImage = img;
                fullSheet.src = path;

                animCanvas.width = frameWidth;
                animCanvas.height = frameHeight;

                currentFrame = 0;
                sheetInfo.textContent = `–†–∞–∑–º–µ—Ä: ${img.width}√ó${img.height} | –°–µ—Ç–∫–∞: ${gridColumns}√ó${Math.ceil(totalFrames/gridColumns)} | –ö–∞–¥—Ä–æ–≤: ${totalFrames}`;

                if (isPlaying) startAnimation();
            };
            img.onerror = () => {
                alert(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å: ${path}`);
            };
            img.src = path;
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞–¥—Ä–∞
        function drawFrame(frameIndex) {
            if (!currentImage) return;

            ctx.clearRect(0, 0, animCanvas.width, animCanvas.height);

            const col = frameIndex % gridColumns;
            const row = Math.floor(frameIndex / gridColumns);

            ctx.drawImage(
                currentImage,
                col * frameWidth, row * frameHeight, frameWidth, frameHeight,
                0, 0, frameWidth, frameHeight
            );

            frameInfo.textContent = `–ö–∞–¥—Ä: ${frameIndex + 1} / ${totalFrames}`;
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è
        function animate(timestamp) {
            if (!isPlaying) return;

            const frameInterval = 1000 / fps;

            if (timestamp - lastFrameTime >= frameInterval) {
                currentFrame = (currentFrame + 1) % totalFrames;
                drawFrame(currentFrame);
                lastFrameTime = timestamp;
            }

            animationId = requestAnimationFrame(animate);
        }

        function startAnimation() {
            if (animationId) cancelAnimationFrame(animationId);
            isPlaying = true;
            document.getElementById('playBtn').classList.add('active');
            document.getElementById('stopBtn').classList.remove('active');
            lastFrameTime = 0;
            animationId = requestAnimationFrame(animate);
        }

        function stopAnimation() {
            isPlaying = false;
            document.getElementById('playBtn').classList.remove('active');
            document.getElementById('stopBtn').classList.add('active');
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        document.getElementById('playBtn').addEventListener('click', startAnimation);
        document.getElementById('stopBtn').addEventListener('click', stopAnimation);

        document.getElementById('prevFrame').addEventListener('click', () => {
            stopAnimation();
            currentFrame = (currentFrame - 1 + totalFrames) % totalFrames;
            drawFrame(currentFrame);
        });

        document.getElementById('nextFrame').addEventListener('click', () => {
            stopAnimation();
            currentFrame = (currentFrame + 1) % totalFrames;
            drawFrame(currentFrame);
        });

        speedSlider.addEventListener('input', () => {
            fps = parseInt(speedSlider.value);
            speedValue.textContent = `${fps} FPS`;
        });

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–∞–≥–∞ —Å–≤–µ—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        document.getElementById('faction').value = 'light';
        document.getElementById('loadWizard').click();
    </script>
</body>
</html>
